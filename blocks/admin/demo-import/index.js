(()=>{"use strict";const e=window.React,t=window.wp.i18n,a=window.wp.components,o=window.wp.element;function n({demoQuery:n,onDemoDataFetched:s}){const[l,r]=(0,o.useState)(!1),[c,m]=(0,o.useState)(!1),[p,u]=(0,o.useState)(null),i=n.content.replace(/\/$/,""),d=n.category_slug.includes("pro")?"pro":"free";return(0,o.useEffect)((()=>{"pro"===d||c||(async()=>{r(!0);try{const e={"Content-Type":"application/json",Authorization:`st ${(()=>{const e=Math.floor(11*Math.random());let t="";for(let a=0;a<13;a++)t+=a===e?"wpOpus":"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(52*Math.random())];return t})()}`,version:d},a=await fetch(i+"/wp-json/wpopusdemoexport/v1/demo",{method:"GET",headers:e});if(!a.ok)throw new Error("Network response was not ok");const o=await a.json();let n=[];o.demoData?n=o.demoData.data?o.demoData.data:o.demoData:u((0,t.__)("Invalid response format","wpopus")),n?(s(n),m(!0)):u((0,t.__)("No demo data found","wpopus"))}catch(e){u(`${(0,t.__)("Error fetching demo routes:","wpopus")} ${e}`)}finally{r(!1)}})()}),[c]),(0,e.createElement)(o.Fragment,null,p?(0,e.createElement)("h3",{className:"wpopus-loading-demo"},p):(0,e.createElement)(o.Fragment,null,l?(0,e.createElement)("h3",{className:"wpopus-loading-demo"},(0,t.__)("Preparing Demo Data","wpopus")," ",(0,e.createElement)(a.Spinner,null)):(0,e.createElement)("h3",{className:"wpopus-loading-demo"},(0,t.__)("Demo Data Prepared","wpopus")," ",(0,e.createElement)(a.Icon,{icon:"yes-alt"}))))}const s=(n,s)=>{const[l,r]=(0,o.useState)(!1),[c,m]=(0,o.useState)(!1),[p,u]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{(async e=>{try{r(!0);const t=await fetch(wpOpus.ajax_url+"?action=wpopus_import_demo",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":wpOpus.import_demo_nonce},body:JSON.stringify({demoData:e.data,demoRoute:e.route})}),a=await t.text();if(!t.ok)throw new Error("Network response was not ok");const o=JSON.parse(a);o.success?m(o.data):u(o.data)}catch(e){u(`${(0,t.__)("Error importing demo data:","wpopus")} ${e}`)}finally{r(!1)}})(n)}),[]),(0,e.createElement)(o.Fragment,null,p?(0,e.createElement)("h3",{className:"wpopus-loading-demo"},p):(0,e.createElement)(o.Fragment,null,l?(0,e.createElement)(o.Fragment,null,(0,e.createElement)("h3",{className:"wpopus-loading-demo"},(0,t.__)("Importing demo data","wpopus")," ",(0,e.createElement)(a.Spinner,null)),Object.keys(n.data.active_plugins).length>0&&(0,e.createElement)("h3",{className:"wpopus-loading-demo"},(0,t.__)("Importing recommended plugins","wpopus")," ",(0,e.createElement)(a.Spinner,null))):(0,e.createElement)(o.Fragment,null,(0,e.createElement)("h3",{className:"wpopus-loading-demo"},(0,t.__)("Demo data imported","wpopus")," ",(0,e.createElement)(a.Icon,{icon:"yes-alt"})),Object.keys(n.data.active_plugins).length>0&&(0,e.createElement)("h3",{className:"wpopus-loading-demo"},(0,t.__)("Recommended plugins installed","wpopus")," ",(0,e.createElement)(a.Icon,{icon:"yes-alt"})),(0,e.createElement)("h3",{className:"wpopus-loading-demo"},c," ",(0,e.createElement)(a.Icon,{icon:"yes-alt"})))))},l=(0,o.memo)((()=>{const[l,r]=(0,o.useState)(!1),[c,m]=(0,o.useState)([]),[p,u]=(0,o.useState)([]),[i,d]=(0,o.useState)(!1),[w,g]=(0,o.useState)(!1),[E,_]=(0,o.useState)(""),[h,y]=(0,o.useState)(""),[f,N]=(0,o.useState)(""),[v,S]=(0,o.useState)(null),[k,D]=(0,o.useState)(null),[b,C]=(0,o.useState)(null),[O,j]=(0,o.useState)([]),[$,I]=(0,o.useState)(!1),F=wpOpus.template_url.replace(/\/$/,""),M=(wpOpus.user_can,async()=>{r(!0);try{const e=(()=>{const e=Math.floor(11*Math.random());let t="";for(let a=0;a<13;a++)t+=a===e?"wpOpus":"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(52*Math.random())];return t})(),a=await fetch(F+"/wp-json/wpopuspatternexport/v1/demoroute",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`st ${e}`}});if(!a.ok)throw new Error("Network response was not ok");const o=await a.json();let n=[];o.templates?n=o.templates.data?o.templates.data:o.templates:D((0,t.__)("Invalid response format","wpopus")),n?(u(n),d(!0)):D((0,t.__)("No demo routes found","wpopus"))}catch(e){D(`${(0,t.__)("Error fetching demo routes:","wpopus")} ${e}`)}finally{r(!1)}});(0,o.useEffect)((()=>{(async()=>{try{const e=["wpopus_recent_demo_url"],t=`/wpopus/v1/getoptions?option_names=${encodeURIComponent(JSON.stringify(e))}`,a=await wp.apiFetch({path:t});Array.isArray(a)&&a.map((e=>{m(e.value)}))}catch(e){D((0,t.__)("Failed to check demo.","wpopus"))}})(),i||M()}),[i]);const A=e=>{y(e)},T=e=>{_(e)},R=p&&p.data?p.data.filter((e=>e.category_slug.includes(h)&&e.category_slug.includes(E))):[],x=p?p.demo_version:[],P=p?p.demo_category:[];return(0,o.useEffect)((()=>{b&&0===Object.keys(b).length&&I(!0)}),[b]),(0,e.createElement)(o.Fragment,null,l?(0,e.createElement)("h3",{className:"wpopus-loading-demo"},(0,t.__)("Loading Demo","wpopus")," ",(0,e.createElement)(a.Spinner,null)):(0,e.createElement)("div",{className:"wpopus-demo-listing-wrapper"},(0,e.createElement)("div",{className:"wpopus-demo-main-filter"},(0,e.createElement)("ul",{className:"demo-version"},(0,e.createElement)("li",{className:""==E?"active":"",onClick:()=>T("")},(0,t.__)("All","wpopus")),x&&x.map((t=>(0,e.createElement)("li",{className:`${t.slug} ${t.slug==E?"active":""}`,key:t.slug,onClick:()=>T(t.slug)},t.name))))),(0,e.createElement)("div",{className:"wpopus-demo-showcase"},(0,e.createElement)("div",{className:"wpopus-category-list-wrapper"},(0,e.createElement)("ul",{className:"category-list"},(0,e.createElement)("li",{className:""==h?"active":"",onClick:()=>A("")},(0,t.__)("All Categories","wpopus")),P&&P.map((t=>(0,e.createElement)("li",{className:`${t.slug} ${t.slug==h?"active":""}`,key:t.slug,onClick:()=>A(t.slug)},t.name))))),(0,e.createElement)("div",{className:"wpopus-demo-container"},R.length>0?(0,e.createElement)("div",{className:"wpopus-demo-wrapper"},(0,e.createElement)("ul",null,R.map(((a,o)=>(0,e.createElement)("li",{key:o,className:`demo-item ${a.category_slug}`},(0,e.createElement)("div",{className:"demo-item-wrapper"},(0,e.createElement)("img",{src:a.featured_image}),(0,e.createElement)("div",{className:"demo-footer"},(0,e.createElement)("h4",null,a.title),(0,e.createElement)("div",{className:"meta-data"},(0,e.createElement)("a",{className:"button button-secondary",href:a.content,target:"_blank"},(0,t.__)("Demo","wpopus")),a.category_slug.includes("free")?(0,e.createElement)("a",{className:"button button-primary",href:"#.",onClick:e=>{e.preventDefault(),(e=>{c===e.content&&D((0,t.__)("This demo has already been imported","wpopus")),S(!0),g(e)})(a)}},(0,t.__)("Import","wpopus")):null)))))))):(0,e.createElement)("p",null,(0,t.__)("No demos available for the selected category.","wpopus")))),v&&w&&(0,e.createElement)(a.Modal,{onRequestClose:()=>S(!1)},!k&&w?(0,e.createElement)(o.Fragment,null,(0,e.createElement)(n,{demoQuery:w,onDemoDataFetched:e=>{N(e),C(e.active_plugins)}}),f&&!$&&b&&Object.keys(b).length>0&&(0,e.createElement)("div",{className:"wpopus-select-plugins"},(0,e.createElement)("h3",{className:"wpopus-loading-demo"},(0,t.__)("Select Plugins to Install: Recommended for Demo","wpopus")),Object.entries(b).map((([t,a],o)=>(0,e.createElement)("label",{key:o},(0,e.createElement)("input",{type:"checkbox",checked:O.includes(a),onChange:()=>(e=>{const t=O.includes(e)?O.filter((t=>t!==e)):[...O,e];j(t),f.active_plugins=t})(a)}),(e=>e.split("/")[0].split("-").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" "))(a)))),(0,e.createElement)("button",{className:"button button-primary",onClick:()=>(0===O.length&&(f.active_plugins={}),void I(!0))},(0,t.__)("Confirm","wpopus"))),f&&$&&(0,e.createElement)(s,{data:f,route:p.data})):(0,e.createElement)("h3",{className:"wpopus-loading-demo"},k))))}));document.addEventListener("DOMContentLoaded",(function(){document.getElementById("wpopus-demo-import")&&(0,o.render)((0,e.createElement)(l,null),document.getElementById("wpopus-demo-import"))}))})();
(()=>{"use strict";const e=window.React,t=window.wp.i18n,a=window.wp.plugins,l=window.wp.editPost,s=window.wp.components,n=window.wp.element,o=window.wp.blocks,r=window.wp.data,p=(0,n.memo)((()=>{const[a,l]=(0,n.useState)(!1),[p,c]=(0,n.useState)(!1),[i,u]=(0,n.useState)(null),[m,w]=(0,n.useState)(!1),[d,g]=(0,n.useState)("template"),[_,v]=(0,n.useState)(""),[f,E]=(0,n.useState)(""),[y,h]=(0,n.useState)(""),[N,k]=(0,n.useState)(null),$=(0,n.useRef)(),[S,C]=(0,n.useState)([]),[b,O]=(0,n.useState)({ok:!1,error:null,loading:!1}),[A,M]=(0,n.useState)([]),T=wpOpus.template_url.replace(/\/$/,""),x=wpOpus.plugin_version,F=(wpOpus.user_can,wpOpus.theme_name),I=(wpOpus.theme_author,async()=>{c(!0);try{const e={"Content-Type":"application/json",Authorization:`st ${(()=>{const e=Math.floor(11*Math.random());let t="";for(let a=0;a<13;a++)t+=a===e?"wpOpus":"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(52*Math.random())];return t})()}`},a=await fetch(T+"/wp-json/wpopuspatternexport/v1/templates",{method:"GET",headers:e});if(!a.ok)throw new Error("Network response was not ok");const l=await a.json();let s=[];l.templates?s=l.templates.data?l.templates.data:l.templates:k((0,t.__)("Invalid response format","wpopus")),s?(u(s),w(!0)):k((0,t.__)("No templates found","wpopus"))}catch(e){k(`${(0,t.__)("Error fetching templates:","wpopus")} ${e}`)}finally{c(!1)}});(0,n.useEffect)((()=>{"pro"!==x&&a&&!m&&I()}),[a,m]);const B=e=>{"template"==d?v(e):h(e)},R=e=>{E(e)},j=i&&i.data?i.data.filter((e=>"template"==d?"fav"==f?e.category_slug.includes(d)&&e.category_slug.includes(_)&&A.includes(e.id):e.category_slug.includes(d)&&e.category_slug.includes(_)&&e.category_slug.includes(f):"fav"==f?e.category_slug.includes(d)&&e.category_slug.includes(y)&&A.includes(e.id):e.category_slug.includes(d)&&e.category_slug.includes(y)&&e.category_slug.includes(f))):[],D=i?i.template_type:[],L=i?i.template_version:[],P=i?i.template_category:[],z=i?i.block_category:[];let q="template"==d?P:z;(0,n.useEffect)((()=>{G()}),[]),(0,n.useEffect)((()=>{(async()=>{if(O({...b,loading:!0}),S.length>0)try{const e=await J("wpopus_favourite_templates")||[];M(e)}finally{O({ok:!0,error:null,loading:!1})}})()}),[S]);const G=async()=>{O({...b,loading:!0});try{const e=["wpopus_favourite_templates"],a=`/wpopus/v1/getoptions?option_names=${encodeURIComponent(JSON.stringify(e))}`,l=await wp.apiFetch({path:a});Array.isArray(l)?(C(l),O({ok:!0,error:null,loading:!1})):O({ok:!1,error:(0,t.__)("Invalid response format","wpopus"),loading:!1})}catch(e){O({ok:!1,error:(0,t.__)("An error occurred while fetching options","wpopus"),loading:!1})}},J=e=>{if(S){const t=S.findIndex((t=>t.name===e));if(-1!==t)return S[t].value}return!1};return(0,e.createElement)(n.Fragment,null,(0,e.createElement)(s.Button,{ref:$,onClick:()=>{l((e=>!e))},icon:"screenoptions",className:"wpopus-pattern-importer is-primary"},(0,t.__)("wpOpus Templates","wpopus")),a&&(0,e.createElement)(s.Modal,{title:`${F} ${(0,t.__)("Templates","wpopus")}`,className:`wpopus-templates ${x}`,onRequestClose:()=>l(!1)},N?(0,e.createElement)("h3",{className:"wpopus-loading-templates"},N):(0,e.createElement)(n.Fragment,null,p?(0,e.createElement)("h3",{className:"wpopus-loading-templates"},(0,t.__)("Loading Templates","wpopus")," ",(0,e.createElement)(s.Spinner,null)):(0,e.createElement)("div",{className:"wpopus-template-listing-wrapper"},(0,e.createElement)("div",{className:"wpopus-template-main-filter"},(0,e.createElement)("ul",{className:"template-types"},D&&D.map((t=>(0,e.createElement)("li",{className:`${t.slug} ${t.slug==d?"active":""}`,key:t.slug,onClick:()=>(e=>{g(e)})(t.slug)},t.name)))),(0,e.createElement)("ul",{className:"template-version"},(0,e.createElement)("li",{className:""==f?"active":"",onClick:()=>R("")},(0,t.__)("All","wpopus")),(0,e.createElement)("li",{className:"fav "+("fav"==f?"active":""),onClick:()=>R("fav")},(0,t.__)("Favourite","wpopus")),L&&L.map((t=>(0,e.createElement)("li",{className:`${t.slug} ${t.slug==f?"active":""}`,key:t.slug,onClick:()=>R(t.slug)},t.name))))),(0,e.createElement)("div",{className:"wpopus-template-showcase"},(0,e.createElement)("div",{className:"wpopus-category-list-wrapper"},(0,e.createElement)("ul",{className:"category-list"},(0,e.createElement)("li",{className:"template"==d?""==_?"active":"":""==y?"active":"",onClick:()=>B("")},(0,t.__)("All Categories","wpopus")),q&&q.map((t=>(0,e.createElement)("li",{className:`${t.slug} ${"template"==d?t.slug==_?"active":"":t.slug==y?"active":""}`,key:t.slug,onClick:()=>B(t.slug)},t.name))))),(0,e.createElement)("div",{className:"wpopus-patterns-container"},j.length>0?(0,e.createElement)("div",{className:"wpopus-patterns-wrapper"},(0,e.createElement)("ul",null,j.map(((a,s)=>(0,e.createElement)("li",{key:s,className:`template-item ${a.category_slug} ${A.includes(a.id)?"fav":""}`},(0,e.createElement)("div",{className:"template-item-wrapper"},(0,e.createElement)("img",{src:a.featured_image}),(0,e.createElement)("div",{className:"template-details"},(0,e.createElement)("h4",null,a.title),(0,e.createElement)("div",{className:"template-meta"},(0,e.createElement)("a",{href:a.link,className:"button button-secondary",target:"_blank",rel:"nofollow"},(0,t.__)("Demo","wpopus")),a.category_slug.includes("free")?(0,e.createElement)("a",{className:"button button-primary",href:"#.",onClick:e=>{e.preventDefault(),(e=>{try{const t=(0,o.parse)(e.content);(0,r.dispatch)("core/block-editor").insertBlocks(t),l(!1)}catch(e){k(`${(0,t.__)("Error fetching templates:","wpopus")} ${e}`)}})(a)}},(0,t.__)("Insert","wpopus")):null),(0,e.createElement)("div",{className:"wpopus-favourite-svg "+(A.includes(a.id)?"fav":""),onClick:()=>{const e=A.includes(a.id)?A.filter((e=>e!==a.id)):[...A,a.id];M(e),(async(e,a)=>{try{await wp.apiFetch({path:"/wpopus/v1/updateoption",method:"POST",data:{option_name:"wpopus_favourite_templates",option_value:a||""}})}catch(e){k((0,t.__)("An error occurred while saving option","wpopus")),console.error("Error saving options:",e)}})(0,e)}},(0,e.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)("path",{d:"M20.8 4.6a5.8 5.8 0 0 0-8.4 0L12 5l-.4-.4a5.8 5.8 0 1 0-8.4 8.4L12 21l8.8-8.8a5.8 5.8 0 0 0 0-8.4z"})))))))))):(0,e.createElement)("p",null,(0,t.__)("No templates available for the selected category.","wpopus"))))))))}));(0,a.registerPlugin)("wpopus-pattern-import-button",{render:()=>(0,e.createElement)(l.__experimentalMainDashboardButton,null,(0,e.createElement)(p,null))})})();